USE [DMS]
GO
/****** Object:  StoredProcedure [dbo].[proc_GetComplaintService]    Script Date: 7/14/2022 11:40:42 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================-- Author		:		<Author Name>-- Create date	:		<Created Date>-- Description	:		<Purpose of the SP>-- ==============================================-- EXECUTE [dbo].[proc_GetComplaintService] '','0','0' , '', '', '', 0, 0, 0,1ALTER proc [dbo].[proc_GetComplaintService] ( @ComplaintNo varchar(50)='',                @EnquiryType varchar(50)='',@ComplaintMode varchar(50)='',@CustomerMobile varchar(50)='',                @CustomerName varchar(50)='', @Status varchar(50),@CompanyBranchId  int =0  ,@ServiceEngineerId  int =0    , @DealerId  int =0  ,@ComplaintStatus int = 0)                    as   -- -------------------------------------------------------- History -------------------------------------------------------------------------------- --    Date			Story					Developer			Description  -- ----------- ----------------------- ------------------- ------------------------------------------------------------------------------------------- 21-May-2022								Dheeraj Kumar		Filter records by employee / dealer id-- /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////begin                    set nocount on;                     declare @strSql as nvarchar(4000);                 set @strSql='select E.ComplaintId,                E.ComplaintNo,                     E.EnquiryType, E.ComplaintMode,E.CustomerMobile,E.CustomerName , E.Status as Status,isnull(E.BranchId,0)  CompanyBranchId,isnull(cb.BranchName,'''')  CompanyBranchName ,C.CustomerName AS DealerName,CONCAT(Emp.FirstName, '' '', Emp.LastName ) AS EmployeeName,ISNULL(E.ComplaintStatus,0) AS ComplaintStatusfrom [ComplaintService] E left join [ComapnyBranch] cb on E.BranchId = cb.CompanyBranchIdLEFT JOIN Employee AS Emp ON E.EmployeeID = Emp.EmployeeIDLEFT JOIN Customer AS C ON E.DealerID = C.CustomerIDwhere 1=1'                    if @ComplaintNo<>''                    begin                    set @strSql=@strSql + ' and E.ComplaintNo like ''%' + @ComplaintNo + '%''';                    end      if @EnquiryType<>'0'                    begin                    set @strSql=@strSql +' and E.EnquiryType like ''%' + @EnquiryType + '%''';                    end                    if @ComplaintMode <> '0'                    begin                    set @strSql=@strSql + ' and E.ComplaintMode = '''+@ComplaintMode + '''';                    end                    if @CustomerMobile<>''                    begin                    set @strSql=@strSql + ' and E.CustomerMobile = ''' + @CustomerMobile + '''';                    endif @CustomerName<>''                    begin                    set @strSql=@strSql + ' and E.CustomerName LIKE ''%' + @CustomerName + '%''';                    endif @CompanyBranchId<>0                  begin                  set @strSql=@strSql + ' and E.BranchId =' + cast(@CompanyBranchId as varchar) + '';                  end              if @Status <> ''                    begin   set @strSql=@strSql + ' and  E.Status = ''' + convert(varchar(50),@Status) + '''';                                     end   if @ServiceEngineerId <> 0                  begin                  set @strSql=@strSql + ' and E.EmployeeID =''' + cast(@ServiceEngineerId as varchar) + '''';                  end if @DealerId <> 0                  begin                  set @strSql=@strSql + ' and E.DealerID =''' + cast(@DealerId as varchar) + '''';                  end if @ComplaintStatus <> 0                  begin                  set @strSql=@strSql + ' and ISNULL(E.ComplaintStatus,0) =''' +cast(@ComplaintStatus as varchar) + '''';                 end           set @strSql=@strSql + ' order by E.ComplaintNo Desc '--PRINT @strSql--select @strSqlexec sp_executesql @strSql                        set nocount off;                    end 


